using Il2Cpp;
using Il2CppVRC.SDKBase;
using System.Collections;
using UnityEngine;

namespace StellarV3External.Features.Exploits
{
    internal class FakeLag
    {
        public static bool fakeLag = false;

        public static IEnumerator FakeLagToggle()
        {
            var localPlayer = Networking.LocalPlayer;
            if (localPlayer == null)
                yield break;

            var serializer = localPlayer.gameObject.GetComponent<MonoBehaviour1PrivateIFlatBufferNetworkSerializerILoggableClassHa1ObVeObBoVeSpBoSyUnique>();
            if (serializer == null)
                yield break;

            bool state = true;
            float nextToggle = Time.realtimeSinceStartup;

            while (fakeLag)
            {
                if (Time.realtimeSinceStartup >= nextToggle)
                {
                    state = !state;
                    serializer.enabled = state;

                    nextToggle = Time.realtimeSinceStartup + 0.7f;
                }

                yield return null;
            }

            serializer.enabled = true;
        }
    }
}
