using Il2Cpp;
using Il2CppVRC.Core;
using Il2CppVRC.SDKBase;
using StellarV3External.SDK.Utils;

namespace StellarV3.Features.Exploits
{
    internal class Spoofer
    {
        public static bool nameSpoof = false;
        public static string nameSpoofText = "StellarV3";

        public static void NameSpoof()
        {
            var localPlayer = PlayerUtils.LocalPlayer();
            var networkingPlayer = Networking.LocalPlayer;
            var currentUser = APIUser.CurrentUser;

            if (localPlayer?.name == null && networkingPlayer?.displayName == null && currentUser?.displayName == null) { }
            else
            {
                try
                {
                    if (nameSpoof)
                    {
                        var name = nameSpoofText;

                        if (networkingPlayer != null)
                            networkingPlayer.displayName = name;

                        if (localPlayer != null)
                            localPlayer.name = name;

                        if (currentUser != null)
                            currentUser.displayName = name;
                    }
                    else if (RoomManager.field_Internal_Static_ApiWorld_0 == null) { }
                    else
                    {
                        var name = RoomManager.field_Internal_Static_ApiWorld_0?.authorName ?? "DefaultName";

                        if (networkingPlayer != null)
                            networkingPlayer.displayName = name;

                        if (localPlayer != null)
                            localPlayer.name = name;

                        if (currentUser != null)
                            currentUser.displayName = name;
                    }
                }
                catch { }
            }
        }
    }
}
